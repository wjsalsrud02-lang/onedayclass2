<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
    {% for message in get_flashed_messages() %}
    <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}

    <h2 class="border-bottom py-2">{{ question.subject }}</h2>
    <div class="card my-3 position-relative" style="padding-bottom: 3rem;">
        <div class="card-body">
            <div style="white-space: pre-line;">{{ question.content }}</div>
            {% if question.image_path %}
            <img src="{{ url_for('static', filename=question.image_path) }}" class="img-thumbnail my-3" style="max-width:100%;"/>
            {% endif %}
        </div>
        <div class="position-absolute bottom-0 start-0 p-2 text-muted small">
            작성일: {{ question.create_date|datetime }}
            {% if question.modify_date %}
            | 수정일: {{ question.modify_date|datetime }}
            {% endif %}
        </div>
        {% if current_user.is_authenticated and current_user == question.user %}
        <div class="position-absolute bottom-0 end-0 p-2">
            <a href="{{ url_for('question.modify', question_id=question.id) }}" class="btn btn-sm btn-outline-secondary">수정</a>
            <a href="{{ url_for('question.delete', question_id=question.id) }}"
               class="btn btn-orange"
               onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
        </div>
        {% endif %}
    </div>

    <h5 class="border-bottom my-3 py-2">
        {% if question.answer_set|length > 0 %}
        ✅ 현재 상태: <span class="badge bg-success">답변완료</span>
        {% else %}
        ⏳ 현재 상태: <span class="badge bg-secondary">답변대기</span>
        {% endif %}
    </h5>

    {% for answer in question.answer_set %}
    <div class="card my-3 position-relative" style="padding-bottom: 3rem;">
        <div class="card-body">
            <div style="white-space: pre-line;">{{ answer.content }}</div>
        </div>
        <div class="position-absolute bottom-0 start-0 p-2 text-muted small">
            작성일: {{ answer.create_date|datetime }}
            {% if answer.modify_date %}
            | 수정일: {{ answer.modify_date|datetime }}
            {% endif %}
        </div>
        {% if current_user.is_authenticated and current_user == answer.user %}
        <div class="position-absolute bottom-0 end-0 p-2">
            <a href="{{ url_for('answer.modify', answer_id=answer.id) }}" class="btn btn-sm btn-outline-secondary">수정</a>
            <a href="{{ url_for('answer.delete', answer_id=answer.id) }}"
               class="btn btn-orange"
               onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <form action="{{ url_for('answer.create', question_id=question.id) }}" method="post" class="my-3">
        {{ form.csrf_token }}
        <textarea name="content" class="form-control mb-3" rows="6" placeholder="답변 입력..."></textarea>
        <button type="submit" class="btn btn-orange">✍️ 답변 등록</button>
    </form>
</div>
{% endblock %}
